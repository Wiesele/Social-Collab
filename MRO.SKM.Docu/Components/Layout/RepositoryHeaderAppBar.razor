@using global::Google.GenAI.Types
@using MRO.SKM.SDK.Models.LanaugeModels
@using MRO.SMK.SDK.Models
@inject IJSRuntime JS
@inject RepositoryService RepositoryService;
@inject LoaderService loader;


<MudThemeProvider @ref="MudThemeProvider" @bind-IsDarkMode="@IsDarkMode"/>


<MudAppBar Elevation="1">
    @if (this.Repository != null)
    {
        <MudText Typo="Typo.h5" Class="ml-3">
            @this.Repository.Name
        </MudText>

        <MudItem Class="ml-3" Style="max-width: 200px">
            <GitControls Repository="Repository"></GitControls>
        </MudItem>

        <MudSpacer/>
        <MudTooltip Text="Repository neu laden" Class="ml-3">
            <MudIconButton Icon="@Icons.Material.Filled.Refresh" Color="Color.Inherit"
                           OnClick="ReloadRepository"></MudIconButton>
        </MudTooltip>
        
        <GenerateStyleGuideButton Repository="this.Repository"></GenerateStyleGuideButton>

        <MudIconButton Icon="@Icons.Material.Filled.Notifications" Color="@Color.Inherit"></MudIconButton>
        <MudToggleIconButton @bind-Toggled="IsDarkMode"
                             Icon="@Icons.Material.Filled.DarkMode" Color="@Color.Inherit"
                             ToggledIcon="@Icons.Material.Filled.LightMode" ToggledColor="@Color.Inherit"/>
    }

</MudAppBar>

@code {
    [Parameter] public Repository? Repository { get; set; }
    public bool IsDarkMode;
    public required MudThemeProvider MudThemeProvider;

    private bool IsDownloading = false;

    void ChangeDarkMode()
    {
        IsDarkMode = !IsDarkMode;
    }


    async Task ReloadRepository()
    {
        await this.loader.ShowLoader("Lade Codestruktur");
        await this.RepositoryService.ReloadRepository(this.Repository);
        this.loader.HideLoader();
    }

}